#!@SHELL@

. @LIBEXECDIR@/sh/functions.sh

_sysconf="${XDG_CONFIG_HOME:-${HOME}/.config}/rc"

for config in "@SYSCONFDIR@/rc.conf" "$_sysconf/rc.conf"; do
	if [ -e "$config" ] && ! . "$config"; then
		eerror "openrc-user: Failed loading $config"
		exit 1
	fi
done

case $1 in
	start) runlevel="${rc_default_runlevel:-default}";;
	stop) runlevel="shutdown";;
	*) eerror "no argument given to $0" && exit 1
esac

for runlevel_dir in sysinit "$runlevel" shutdown; do
	mkdir -p "$_sysconf/runlevels/$runlevel_dir"
done

openrc --user sysinit || exit 1
printf '\n' >&3 # Notify openrc we're ready to start
exec openrc --user "$runlevel"
